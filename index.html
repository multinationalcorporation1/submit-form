<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Submit to Google Form — Polished</title>
  <style>
    body{font-family:system-ui,Arial;margin:20px;max-width:720px;color:#111}
    label{display:block;margin-top:12px;font-weight:600}
    input{width:100%;padding:10px;margin-top:6px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box}
    button{margin-top:12px;padding:10px 14px;background:#0f62fe;color:#fff;border:0;border-radius:6px;cursor:pointer}
    button[disabled]{opacity:0.6;cursor:not-allowed}
    #status{margin-top:12px;font-weight:600}
    pre{background:#f3f4f6;padding:8px;border-radius:6px;white-space:pre-wrap}
    .note{color:#666;margin-top:8px}
  </style>
</head>
<body>
  <h2>Submit to Google Form — Polished</h2>
  <p class="note">One-click save using hidden-form fallback. <strong>Security note:</strong> don't store real passwords/secret keys in a Google Sheet. Use this only for non-sensitive data.</p>

  <label for="name">Name</label>
  <input id="name" type="text" placeholder="man-1">

  <label for="e_post">E-post</label>
  <input id="e_post" type="email" placeholder="you@example.com">

  <label for="pwd">Key</label>
  <input id="pwd" type="text" placeholder="secret">

  <button id="sendBtn">Submit</button>
  <div id="status" aria-live="polite"></div>
  <pre id="debug" style="display:none"></pre>

  <!-- Hidden form which posts to Google Form (entry IDs already set) -->
  <iframe name="hidden_iframe" style="display:none"></iframe>
  <form id="fallback" action="https://docs.google.com/forms/d/e/1FAIpQLSc1koXMqPjJiVTp4PiwUTWiq8mm1mUA90XQYVUC0ORMBCL-8A/formResponse" method="POST" target="hidden_iframe" style="display:none;">
    <input name="entry.624312929" id="f_name">
    <input name="entry.1254027685" id="f_epost">
    <input name="entry.818359634" id="f_key">
    <input name="entry.999999999" id="f_useragent">
    <input name="entry.888888888" id="f_timestamp">
  </form>

<script>
(function(){
  // Config (already set): change only if you know the entry IDs
  const entryName = 'entry.624312929';
  const entryEpost = 'entry.1254027685';
  const entryKey  = 'entry.818359634';
  // The following two entries are optional placeholders in the form; if the form does not have these fields, they will be ignored by Google.
  const entryUA = 'entry.999999999';
  const entryTS = 'entry.888888888';

  const $ = id => document.getElementById(id);
  const nameEl = $('name'), epostEl = $('e_post'), pwdEl = $('pwd');
  const sendBtn = $('sendBtn'), status = $('status'), debug = $('debug');
  const fallbackForm = $('fallback');

  function setStatus(txt, ok){ status.textContent = txt; status.style.color = ok ? '#15803d' : '#b91c1c'; }
  function showDebug(o){ debug.style.display = 'block'; debug.textContent = typeof o === 'string' ? o : JSON.stringify(o,null,2); }

  function sanitize(s){ return (s||'').trim(); }

  function fillHiddenFields(){
    // copy visible values to hidden inputs
    $('f_name').value = sanitize(nameEl.value);
    $('f_epost').value = sanitize(epostEl.value);
    $('f_key').value = sanitize(pwdEl.value);
    // optional diagnostics: user agent and timestamp
    try{ $('f_useragent').value = navigator.userAgent || ''; }catch(e){ $('f_useragent').value = ''; }
    try{ $('f_timestamp').value = new Date().toISOString(); }catch(e){ $('f_timestamp').value = ''; }
  }

  function disableButton(){ sendBtn.disabled = true; }
  function enableButton(){ sendBtn.disabled = false; }

  async function sendOnce(){
    setStatus('Preparing...', false);
    debug.style.display = 'none';

    const name = sanitize(nameEl.value);
    const epost = sanitize(epostEl.value);
    const key = sanitize(pwdEl.value);
    if(!name && !epost && !key){ setStatus('Fill at least one field before submit', false); return; }

    disableButton(); setStatus('Submitting...', false);
    fillHiddenFields();

    // First attempt: fetch no-cors (best-effort, may be opaque)
    try{
      const params = new URLSearchParams();
      params.append(entryName, name);
      params.append(entryEpost, epost);
      params.append(entryKey, key);
      // send fetch (no-cors) to keep it simple
      await fetch(fallbackForm.action, { method: 'POST', body: params, mode: 'no-cors' });
      // we assume it left the browser; still show confirmation
      setStatus('Submitted (fetch — best-effort). Check responses.', true);
      // clear inputs for UX
      nameEl.value = ''; epostEl.value = ''; pwdEl.value = '';
      enableButton(); return;
    }catch(err){ /* fall through to hidden form */ }

    // fallback: submit hidden form which targets an invisible iframe
    try{
      fallbackForm.submit();
      setStatus('Submitted via hidden form. Check responses.', true);
      nameEl.value = ''; epostEl.value = ''; pwdEl.value = '';
      enableButton();
    }catch(e){
      setStatus('Submission failed', false); showDebug(e); enableButton();
    }
  }

  sendBtn.addEventListener('click', sendOnce);
  [nameEl, epostEl, pwdEl].forEach(el=>el.addEventListener('keydown', ev=>{ if(ev.key==='Enter'){ ev.preventDefault(); sendOnce(); } }));

})();
</script>
</body>
</html>
